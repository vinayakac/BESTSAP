/*!
 * @package Content Aware Sidebars
 * @author Joachim Jensen <jv@intox.dk>
 * @license GPLv3
 * @copyright 2018 by Joachim Jensen
 */
!function($){"use strict";var e={$sidebarContainer:$(".widget-liquid-right"),$widgetContainer:$("#available-widgets"),init:function(){this.openSidebarByURL(),this.addSidebarToolbar(),this.addWidgetSearch(),this.toggleSidebarStatus(),this.enhancedWidgetManager()},openSidebarByURL:function(){if(window.location.hash){var e=this.$sidebarContainer.find(".widgets-holder-wrap"),i=e.has(window.location.hash);i.length&&i.add(e.first()).find(".handlediv,.sidebar-name-arrow").trigger("click")}},enhancedWidgetManager:function(){if($("body").hasClass("cas-widget-manager")){this.$widgetContainer.find(".widget").draggable("option","scroll",!1);var e=this,i=$("#widgets-left .inactive-sidebar");i.toggle(this.$widgetContainer.hasClass("closed")),this.$widgetContainer.find(".sidebar-name").click(function(t){i.toggle(e.$widgetContainer.hasClass("closed"))})}},toggleSidebarStatus:function(){$(".widget-liquid-right").on("change",".sidebar-status-input",function(e){var i=$(this),t=i.is(":checked");!i.hasClass("sidebar-status-future")||confirm(CASAdmin.enableConfirm)?$.post(ajaxurl,{action:"cas_sidebar_status",sidebar_id:i.val(),status:t},function(e){e.success?(i.next().attr("title",e.data.title),i.removeClass("sidebar-status-future")):i.attr("checked",!t)}):i.attr("checked",!t)})},addWidgetSearch:function(){var e=$(".widget",this.$widgetContainer).get().reverse();$(".sidebar-description",this.$widgetContainer).prepend('<input type="search" class="js-cas-widget-filter cas-filter-widget" placeholder="'+CASAdmin.filterWidgets+'...">'),this.searchWidgetListener(e)},searchWidgetListener:function(e){var i,t="";this.$widgetContainer.on("input",".js-cas-widget-filter",function(a){var s=$(this).val();s!=t&&(t=s,i&&clearTimeout(i),i=setTimeout(function(){$(e).each(function(e,i){var t=$(i);t.find(".widget-title :nth-child(1)").text().search(new RegExp(s,"i"))<0?t.fadeOut():(t.prependTo(t.parent()),t.fadeIn().css("display",""))})},250))})},addSidebarToolbar:function(){var e='<div class="wp-filter cas-filter-sidebar"><a href="admin.php?page=wpcas-edit" class="button button-primary">'+CASAdmin.addNew+'</a><input type="search" class="js-cas-filter" placeholder="'+CASAdmin.filterSidebars+'..."><a href="#" title="'+CASAdmin.collapse+'" class="js-sidebars-toggle sidebars-toggle" data-toggle="0"><span class="dashicons dashicons-arrow-up-alt2"></span></a><a href="#" title="'+CASAdmin.expand+'" class="js-sidebars-toggle sidebars-toggle" data-toggle="1"><span class="dashicons dashicons-arrow-down-alt2"></span></a></div>';this.$sidebarContainer.prepend(e),this.searchSidebarListener(),this.addSidebarToggle()},addSidebarToggle:function(){var e=$(document),i=this.$sidebarContainer.find(".widgets-holder-wrap");$("body").on("click",".js-sidebars-toggle",function(t){t.preventDefault();var a=!!$(this).data("toggle");i.toggleClass("closed",!a),a&&i.children(".widgets-sortables").sortable("refresh"),e.triggerHandler("wp-pin-menu")})},searchSidebarListener:function(){var e,i=this,t="";this.$sidebarContainer.on("input",".js-cas-filter",function(a){var s=$(this).val();s!=t&&(t=s,e&&clearTimeout(e),e=setTimeout(function(){$(".widgets-holder-wrap",i.$sidebarContainer).each(function(e,i){var t=$(i);t.find(".sidebar-name :nth-child(2)").text().search(new RegExp(s,"i"))<0?t.fadeOut():t.fadeIn()})},250))})}};$(document).ready(function(){e.init()})}(jQuery);