/*!
 * @package Content Aware Sidebars
 * @author Joachim Jensen <jv@intox.dk>
 * @license GPLv3
 * @copyright 2018 by Joachim Jensen
 */
!function($){"use strict";var t={current_section:0,sections:[],init:function(){this.tabController(),this.actionOptionHandler(),this.suggestVisibility(),this.initSidebarActivation(),$(".js-cas-color-field").wpColorPicker(),$(".js-cas-html").on("change",function(t){var n=$(this);$(n.data("target")).attr("disabled",!n.is(":checked"))}).trigger("change")},initSidebarActivation:function(){flatpickr.l10ns.default.weekdays=CASAdmin.weekdays,flatpickr.l10ns.default.months=CASAdmin.months,flatpickr.l10ns.default.firstDayOfWeek=CASAdmin.weekStart;var t=flatpickr(".js-cas-activation",{wrap:!0,clickOpens:!0,enableTime:!0,time_24hr:!0,allowInput:!0,enableSeconds:!0,onChange:function(t,i,a){(i||n.config.minDate)&&n.set("minDate",i?new Date(t).fp_incr(1):null),i?e.prop("checked",!1):e.is(":checked")||n.clear()}}),n=flatpickr(".js-cas-expiry",{wrap:!0,clickOpens:!0,enableTime:!0,time_24hr:!0,allowInput:!0,enableSeconds:!0,altInput:!0,altFormat:CASAdmin.dateFormat+" @ H:i:S",onChange:function(n,e,i){(e||t.config.maxDate)&&t.set("maxDate",e?new Date(n).fp_incr(-1):null)}}),e=$(".js-cas-status");e.on("change",function(e){$(this).is(":checked")?t.clear():t.selectedDates.length||n.clear()})},initTabSections:function(){$(".js-cas-tabs").find(".nav-tab").each(function(){var n=this.href.lastIndexOf("#");if(n>=0){var e=this.href.substr(n);t.sections.push(e),$(e).hide()}})},tabController:function(){this.initTabSections(),this.setCurrentSection(window.location.hash),$("#poststuff").on("click",".js-nav-link",function(n){t.setCurrentSection(this.href)})},findSectionByURL:function(t){var n=this.sections.indexOf(t.substring(t.lastIndexOf("#")));return n>=0?n:null},setCurrentSection:function(t){var n=this.findSectionByURL(t)||0,e=$(".js-cas-tabs").find(".nav-tab");e.eq(n).is(":visible")&&($(this.sections[this.current_section]).hide(),e.eq(this.current_section).removeClass("nav-tab-active"),this.current_section=n,$(this.sections[this.current_section]).show(),e.eq(this.current_section).addClass("nav-tab-active"),$("#_cas_section").val("#top"+this.sections[this.current_section]))},actionOptionHandler:function(){var t=$("#cas-options"),n=t.find(".js-cas-action");t.on("change",".js-cas-handle",function(){var t=$(this),e=n.filter(".js-cas-action-"+t.val());n.not(e).hide().find("input,select").attr("disabled",!0),e.fadeIn("fast").find("input,select").attr("disabled",!1)}),t.find(".js-cas-handle").trigger("change")},suggestVisibility:function(){var t=$(".js-cas-visibility");t.select2({theme:"wpca",placeholder:CASAdmin.allVisibility,minimumInputLength:0,closeOnSelect:!0,allowClear:!1,nextSearchTerm:function(t,n){return n},data:CASAdmin.visibility}).on("select2:selecting",function(n){t.data("forceOpen",!0)}).on("select2:close",function(n){t.data("forceOpen")&&(n.preventDefault(),t.select2("open"),t.data("forceOpen",!1))}),t.data("value")&&t.val(t.data("value").toString().split(",")).trigger("change")}};$(document).ready(function(){t.init()})}(jQuery);